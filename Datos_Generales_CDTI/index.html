<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Recopilación de Datos</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap">
    <link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <!-- Pantalla de Login -->
    <div id="login-screen" class="login-container">
        <div class="login-card">
            <h1>Formulario de Datos Generales CDTI</h1>
            <p class="login-subtitle">Introduzca la contraseña de acceso proporcionada por su consultor:</p>
            <form id="login-form">
                <div class="input-group">
                    <label for="client-password">Contraseña de Cliente:</label>
                    <input type="password" id="client-password" name="clientPassword" 
                           placeholder="Introduzca su contraseña" required>
                </div>
                <button type="submit" class="btn-primary">Acceder al Formulario</button>
                <div id="login-error" class="error-message" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- Aplicación Principal (inicialmente oculta) -->
    <div id="app" class="w-full max-w-6xl" style="display: none;">
        
        <div id="client-view" class="space-y-6">

            <header class="form-header">
                <div class="flex items-center space-x-3">
                    <div class="logo-icon">F</div>
                    <h1 id="main-title">Recopilación de Datos del Cliente</h1>
                    <div id="client-info" class="client-badge" style="display: none;">
                        Cliente: <span id="client-id"></span>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="show-admin-btn" onclick="promptAdminKey()" disabled style="padding: 0.5rem 1rem; background-color: #d1d5db; color: var(--brand); border-radius: 0.375rem; border: none; font-size: 0.875rem; opacity: 0.5;" title="Inicializando...">Admin</button>
                    <button id="logout-btn" onclick="logout()" style="padding: 0.5rem 1rem; background-color: #ef4444; color: white; border-radius: 0.375rem; border: none; font-size: 0.875rem; display: none;">Cerrar Sesión</button>
                    <div id="autosave-indicator" class="autosave-status">Autosave activo</div>
                </div>
            </header>

            <div class="progress-header">
                <span id="progress-label">Paso 1 de 9</span>
                <span id="progress-percentage">0%</span>
            </div>
            <div class="progress-bar-container">
                <div id="progress-bar-fill" class="progress-bar-fill" style="width: 0%;"></div>
            </div>
            <div class="form-layout-grid">
                
                <div class="stepper-column">
                    <nav id="stepper-nav">
                        <ul>
                            <li id="step-1" class="step active">
                                <span class="step-number">1</span>
                                <span class="step-label">Contactos</span>
                            </li>
                            <li id="step-2" class="step">
                                <span class="step-number">2</span>
                                <span class="step-label">Dirección</span>
                            </li>
                            <li id="step-3" class="step">
                                <span class="step-number">3</span>
                                <span class="step-label">Organización</span>
                            </li>
                            <li id="step-4" class="step">
                                <span class="step-number">4</span>
                                <span class="step-label">Recursos Humanos</span>
                            </li>
                            <li id="step-5" class="step">
                                <span class="step-number">5</span>
                                <span class="step-label">Recursos I+D</span>
                            </li>
                            <li id="step-6" class="step">
                                <span class="step-number">6</span>
                                <span class="step-label">Productos/Servicios</span>
                            </li>
                            <li id="step-7" class="step">
                                <span class="step-number">7</span>
                                <span class="step-label">Tipo Entidad</span>
                            </li>
                            <li id="step-8" class="step">
                                <span class="step-number">8</span>
                                <span class="step-label">Datos Bancarios</span>
                            </li>
                            <li id="step-9" class="step">
                                <span class="step-number">9</span>
                                <span class="step-label">Condiciones</span>
                            </li>
                        </ul>
                    </nav>
                </div>

                <div class="content-column">
                    <form id="data-form" onsubmit="event.preventDefault(); saveFormData(true);">
                        
                        <div data-page="1" class="space-y-6">
                            <h3><span class="step-icon">1</span> Página 1 - Contactos</h3>
                            <div id="page1-error-message" class="page-error-message hidden"></div>
                            
                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">Contacto Institucional</h4>
                                <div class="form-grid md:grid-cols-2">
                                    <div>
                                        <label for="instNIF">NIF: <span class="text-red-500">*</span></label>
                                        <input type="text" id="instNIF" oninput="validateField(this, 'nif');" class="input-default" autocomplete="organization">
                                    </div>
                                    <div>
                                        <label for="instNombre">Nombre: <span class="text-red-500">*</span></label>
                                        <input type="text" id="instNombre" oninput="validateField(this, 'required');" class="input-default" autocomplete="name">
                                    </div>
                                    <div>
                                        <label for="instApellidos">Apellidos: <span class="text-red-500">*</span></label>
                                        <input type="text" id="instApellidos" oninput="validateField(this, 'required');" class="input-default" autocomplete="family-name">
                                    </div>
                                    <div>
                                        <label for="instCargo">Cargo: <span class="text-red-500">*</span></label>
                                        <input type="text" id="instCargo" oninput="validateField(this, 'required');" class="input-default">
                                    </div>
                                    <div>
                                        <label for="instTelefono">Teléfono: <span class="text-red-500">*</span></label>
                                        <input type="tel" id="instTelefono" oninput="validateField(this, 'phone');" class="input-default" placeholder="9 dígitos (fijo o móvil)" autocomplete="tel" inputmode="numeric">
                                    </div>
                                    <div>
                                        <label for="instEmail">E-Mail: <span class="text-red-500">*</span></label>
                                        <input type="email" id="instEmail" oninput="validateField(this, 'email');" class="input-default" autocomplete="email">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">Contacto Técnico</h4>
                                <div class="form-grid md:grid-cols-3">
                                    <div>
                                        <label for="tecNombre">Nombre: <span class="text-red-500">*</span></label>
                                        <input type="text" id="tecNombre" oninput="validateField(this, 'required');" class="input-default">
                                    </div>
                                    <div>
                                        <label for="tecApellidos">Apellidos: <span class="text-red-500">*</span></label>
                                        <input type="text" id="tecApellidos" oninput="validateField(this, 'required');" class="input-default">
                                    </div>
                                    <div>
                                        <label for="tecCargo">Cargo: <span class="text-red-500">*</span></label>
                                        <input type="text" id="tecCargo" oninput="validateField(this, 'required');" class="input-default">
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">Contacto Financiero</h4>
                                <div class="form-grid md:grid-cols-3">
                                    <div>
                                        <label for="finNombre">Nombre: <span class="text-red-500">*</span></label>
                                        <input type="text" id="finNombre" oninput="validateField(this, 'required');" class="input-default">
                                    </div>
                                    <div>
                                        <label for="finApellidos">Apellidos: <span class="text-red-500">*</span></label>
                                        <input type="text" id="finApellidos" oninput="validateField(this, 'required');" class="input-default">
                                    </div>
                                    <div>
                                        <label for="finCargo">Cargo: <span class="text-red-500">*</span></label>
                                        <input type="text" id="finCargo" oninput="validateField(this, 'required');" class="input-default">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div data-page="2" class="space-y-4 hidden">
                            <h3><span class="step-icon">2</span> Página 2 - Dirección</h3>
                            <div id="page2-error-message" class="page-error-message hidden"></div>
                            
                            <div class="form-grid md:grid-cols-3">
                                <div>
                                    <label for="dirTipoVia">Tipo vía: <span class="text-red-500">*</span></label>
                                    <input type="text" id="dirTipoVia" oninput="validateField(this, 'required');" class="input-default" placeholder="Ej: Calle, Avenida..." autocomplete="street-address">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="dirDireccion">Dirección: <span class="text-red-500">*</span></label>
                                    <input type="text" id="dirDireccion" oninput="validateField(this, 'required');" class="input-default">
                                </div>
                                <div>
                                    <label for="dirNumero">Número: <span class="text-red-500">*</span></label>
                                    <input type="text" id="dirNumero" oninput="validateField(this, 'number');" class="input-default" inputmode="numeric">
                                </div>
                                <div>
                                    <label for="dirCP">C. Postal: <span class="text-red-500">*</span></label>
                                    <input type="text" id="dirCP" oninput="handleCPInput(this)" class="input-default" placeholder="5 dígitos" inputmode="numeric" maxlength="5" autocomplete="postal-code">
                                </div>
                                <div>
                                    <label for="dirProvincia">Provincia: <span class="text-red-500">*</span></label>
                                    <input type="text" id="dirProvincia" readonly>
                                </div>
                                <div>
                                    <label for="dirLocalidad">Localidad: <span class="text-red-500">*</span></label>
                                    <input type="text" id="dirLocalidad" readonly>
                                </div>
                                <div>
                                    <label for="dirTelefono">Teléfono (Dirección): <span class="text-red-500">*</span></label>
                                    <input type="tel" id="dirTelefono" oninput="validateField(this, 'phone');" class="input-default" placeholder="9 dígitos" autocomplete="tel" inputmode="numeric">
                                </div>
                                <div>
                                    <label for="dirEmail">E-Mail (Dirección): <span class="text-red-500">*</span></label>
                                    <input type="email" id="dirEmail" oninput="validateField(this, 'email');" class="input-default" autocomplete="email">
                                </div>
                            </div>
                        </div>

                        <div data-page="3" class="space-y-4 hidden">
    <h3><span class="step-icon">3</span> Página 3 - Organización</h3>
    <div id="page3-error-message" class="page-error-message hidden"></div>

    <!-- Capital Social (se mantiene tal cual) -->
    <div class="form-section">
        <h4 class="font-semibold text-gray-800">Capital Social (Último año)</h4>
        <div class="form-grid md:grid-cols-2">
            <div>
                <label for="orgAnoCapital">Año Capital Social:</label>
                <select id="orgAnoCapital" class="input-default">
                    <option value="">-- Seleccione --</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                    <option value="2027">2027</option>
                    <option value="2028">2028</option>
                    <option value="2029">2029</option>
                    <option value="2030">2030</option>
                    <option value="2031">2031</option>
                    <option value="2032">2032</option>
                    <option value="2033">2033</option>
                    <option value="2034">2034</option>
                    <option value="2035">2035</option>
                </select>
            </div>
            <div>
                <label for="orgCapitalSocial">Capital Social (€):</label>
                <input type="number" step="0.01" id="orgCapitalSocial" class="input-default">
            </div>
        </div>
    </div>

    <!-- Composición Accionarial -->
    <div class="form-section">
        <h4 class="font-semibold text-gray-800">Composición Accionarial</h4>
        <div id="accionarial-container">
            <div class="accionarial-grupo form-grid md:grid-cols-2" style="background-color: var(--card); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                <div>
                    <label for="acc_1_nombre">Nombre / Razón Social:</label>
                    <input id="acc_1_nombre" type="text" class="input-default">
                </div>
                <div>
                    <label for="acc_1_cif">CIF:</label>
                    <input id="acc_1_cif" type="text" class="input-default">
                </div>
                <div style="position: relative;">
                    <label for="acc_1_pct">% Participación:</label>
                    <input id="acc_1_pct" type="number" step="0.1" class="input-default" oninput="validatePercentageField(this)">
                </div>
                <div>
                    <label for="acc_1_pyme">Pyme:</label>
                    <select id="acc_1_pyme" class="input-default">
                        <option value="">--</option>
                        <option value="Sí">Sí</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div>
                    <label for="acc_1_nacionalidad">Nacionalidad:</label>
                    <input id="acc_1_nacionalidad" type="text" class="input-default">
                </div>
            </div>
        </div>
        <button type="button" onclick="addAccionarialGrupo()" class="mt-4" style="background-color: var(--accent); color: white; padding: 0.6rem 1.2rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; transition: background-color 0.2s ease;" onmouseover="this.style.backgroundColor='var(--accent-2)'" onmouseout="this.style.backgroundColor='var(--accent)'">
            <span style="color: white;">+</span> Añadir Accionista
        </button>
    </div>

    <!-- Consejo -->
    <div class="form-section">
        <h4 class="font-semibold text-gray-800">Composición del Consejo de Administración</h4>
        <div id="consejo-container">
            <div class="consejo-grupo form-grid md:grid-cols-2" style="background-color: var(--card); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                <div>
                    <label for="consejo_1_nombre">Nombre:</label>
                    <input id="consejo_1_nombre" type="text" class="input-default">
                </div>
                <div>
                    <label for="consejo_1_dni">DNI/CIF:</label>
                    <input id="consejo_1_dni" type="text" class="input-default">
                </div>
                <div>
                    <label for="consejo_1_cargo">Cargo:</label>
                    <input id="consejo_1_cargo" type="text" class="input-default">
                </div>
                <div>
                    <label for="consejo_1_nacionalidad">Nacionalidad:</label>
                    <input id="consejo_1_nacionalidad" type="text" class="input-default">
                </div>
            </div>
        </div>
        <button type="button" onclick="addConsejoGrupo()" class="mt-4" style="background-color: var(--accent); color: white; padding: 0.6rem 1.2rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; transition: background-color 0.2s ease;" onmouseover="this.style.backgroundColor='var(--accent-2)'" onmouseout="this.style.backgroundColor='var(--accent)'">
            <span style="color: white;">+</span> Añadir Miembro
        </button>
    </div>

    <!-- Filiales -->
    <div class="form-section">
        <h4 class="font-semibold text-gray-800">Filiales</h4>
        <div id="filial-container">
            <div class="filial-grupo form-grid md:grid-cols-2" style="background-color: var(--card); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                <div>
                    <label for="filial_1_razon">Razón Social:</label>
                    <input id="filial_1_razon" type="text" class="input-default">
                </div>
                <div>
                    <label for="filial_1_cif">CIF:</label>
                    <input id="filial_1_cif" type="text" class="input-default">
                </div>
                <div>
                    <label for="filial_1_actividad">Actividad Principal:</label>
                    <input id="filial_1_actividad" type="text" class="input-default">
                </div>
                <div>
                    <label for="filial_1_pct">% Participación:</label>
                    <input id="filial_1_pct" type="number" step="0.1" class="input-default">
                </div>
                <div>
                    <label for="filial_1_pais">País:</label>
                    <input id="filial_1_pais" type="text" class="input-default">
                </div>
            </div>
        </div>
        <button type="button" onclick="addFilialGrupo()" class="mt-4" style="background-color: var(--accent); color: white; padding: 0.6rem 1.2rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; transition: background-color 0.2s ease;" onmouseover="this.style.backgroundColor='var(--accent-2)'" onmouseout="this.style.backgroundColor='var(--accent)'">
            <span style="color: white;">+</span> Añadir Filial
        </button>
    </div>

</div>

                        <!-- Página 4: Recursos Humanos - será generado dinámicamente por JS -->
                        <div data-page="4" class="space-y-4 hidden">
                            <h3><span class="step-icon">4</span> Página 4 - Recursos Humanos</h3>
                            <div id="page4-error-message" class="page-error-message hidden"></div>
                            <div id="recursos-container" class="space-y-4"></div>
                        </div>

                        <div data-page="5" class="space-y-4 hidden">
                            <h3><span class="step-icon">5</span> Página 5 - Recursos I+D</h3>
                            <p class="text-sm text-gray-500">Indique los gastos e inversiones en I+D del último ejercicio cerrado.</p>
                             <div class="form-grid md:grid-cols-2">
                                <div>
                                    <label for="id_ano">Año de Referencia:</label>
                                    <select id="id_ano" class="input-default">
                                        <option value="">Seleccione año...</option>
                                        <option value="2024">2024</option>
                                        <option value="2025">2025</option>
                                        <option value="2026">2026</option>
                                        <option value="2027">2027</option>
                                        <option value="2028">2028</option>
                                        <option value="2029">2029</option>
                                        <option value="2030">2030</option>
                                        <option value="2031">2031</option>
                                        <option value="2032">2032</option>
                                        <option value="2033">2033</option>
                                        <option value="2034">2034</option>
                                        <option value="2035">2035</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-grid md:grid-cols-2">
                                <div>
                                    <label for="id_inmovilizado">Inmovilizado Material (€):</label>
                                    <input type="number" step="0.01" id="id_inmovilizado" class="input-default" oninput="validateNumericField(this)">
                                </div>
                                <div>
                                    <label for="id_gastos_corrientes">Gastos Corrientes I+D (€):</label>
                                    <input type="number" step="0.01" id="id_gastos_corrientes" class="input-default" oninput="validateNumericField(this)">
                                </div>
                            </div>
                        </div>

                        <div data-page="6" class="space-y-4 hidden">
                            <h3><span class="step-icon">6</span> Página 6 - Productos/Servicios</h3>
                            <div id="page6-error-message" class="page-error-message hidden"></div>
                            
                            <div id="productos-container" class="space-y-4">
                                <!-- Los productos se renderizan dinámicamente aquí -->
                            </div>
                            
                            <button type="button" onclick="addProductoGrupo()" class="btn-add" style="background-color: var(--accent); color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 600; cursor: pointer; border: none;">
                                + Añadir Producto/Servicio
                            </button>
                        </div>
                        
                        <div data-page="7" class="space-y-4 hidden">
                            <h3><span class="step-icon">7</span> Página 7 - Tipo de Entidad</h3>
                            <div id="page7-error-message" class="page-error-message hidden"></div>
                            
                            <div class="form-grid md:grid-cols-2">
                                <div>
                                    <label for="entidadTipo">Tipo de Entidad:</label>
                                    <select id="entidadTipo" class="input-default">
                                        <option value="">-- Seleccione --</option>
                                        <option value="Autonoma">Empresa Autónoma</option>
                                        <option value="Asociada">Empresa Asociada</option>
                                        <option value="Vinculada">Empresa Vinculada</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="entidadTamaño">Tamaño Entidad:</label>
                                    <select id="entidadTamaño" class="input-default">
                                        <option value="">-- Seleccione --</option>
                                        <option value="Pequeña">Pequeña Empresa</option>
                                        <option value="Mediana">Mediana Empresa</option>
                                        <option value="Grande">Gran Empresa</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="entidadPeriodoRef">Periodo de Referencia:</label>
                                    <select id="entidadPeriodoRef" class="input-default" onchange="actualizarEjercicioAnterior()">
                                        <option value="">-- Seleccione --</option>
                                        <option value="2024">2024</option>
                                        <option value="2025">2025</option>
                                        <option value="2026">2026</option>
                                        <option value="2027">2027</option>
                                        <option value="2028">2028</option>
                                        <option value="2029">2029</option>
                                        <option value="2030">2030</option>
                                        <option value="2031">2031</option>
                                        <option value="2032">2032</option>
                                        <option value="2033">2033</option>
                                        <option value="2034">2034</option>
                                        <option value="2035">2035</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-section" style="margin-top: 2rem;">
                                <h4 class="font-semibold text-gray-800">Datos último ejercicio cerrado</h4>
                                <div class="form-grid md:grid-cols-3">
                                    <div>
                                        <label for="ent_efectivos">Efectivos (UTA):</label>
                                        <input type="text" id="ent_efectivos" class="input-default" oninput="validateIntegerField(this)">
                                    </div>
                                    <div>
                                        <label for="ent_volumen_negocio">Volumen de Negocio (€):</label>
                                        <input type="text" id="ent_volumen_negocio" class="input-default" oninput="validateNumericField(this)">
                                    </div>
                                    <div>
                                        <label for="ent_balance_general">Balance General (€):</label>
                                        <input type="text" id="ent_balance_general" class="input-default" oninput="validateNumericField(this)">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800" id="ejercicioAnteriorTitle">Ejercicio anterior</h4>
                                <div class="form-grid md:grid-cols-3">
                                    <div>
                                        <label for="ent_anterior_efectivos">Efectivos (UTA):</label>
                                        <input type="text" id="ent_anterior_efectivos" class="input-default" oninput="validateIntegerField(this)">
                                    </div>
                                    <div>
                                        <label for="ent_anterior_volumen_negocio">Volumen de Negocio (€):</label>
                                        <input type="text" id="ent_anterior_volumen_negocio" class="input-default" oninput="validateNumericField(this)">
                                    </div>
                                    <div>
                                        <label for="ent_anterior_balance_general">Balance General (€):</label>
                                        <input type="text" id="ent_anterior_balance_general" class="input-default" oninput="validateNumericField(this)">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div data-page="8" class="space-y-4 hidden">
                            <h3><span class="step-icon">8</span> Página 8 - Datos Bancarios</h3>
                            <div class="form-grid md:grid-cols-3">
                                <div class="md:col-span-3">
                                    <label for="bankIBAN">IBAN:</label>
                                    <input type="text" id="bankIBAN" class="input-default" placeholder="ES00" maxlength="4" oninput="validateBankField(this, 'iban')">
                                </div>
                                <div>
                                    <label for="bankEntidad">Entidad:</label>
                                    <input type="text" id="bankEntidad" class="input-default" placeholder="1234" maxlength="4" oninput="validateBankField(this, 'entidad')">
                                </div>
                                <div>
                                    <label for="bankOficina">Oficina:</label>
                                    <input type="text" id="bankOficina" class="input-default" placeholder="5678" maxlength="4" oninput="validateBankField(this, 'oficina')">
                                </div>
                                <div>
                                    <label for="bankDC">DC:</label>
                                    <input type="text" id="bankDC" class="input-default" placeholder="90" maxlength="2" oninput="validateBankField(this, 'dc')">
                                </div>
                                <div class="md:col-span-3">
                                    <label for="bankNumero">Número de Cuenta:</label>
                                    <input type="text" id="bankNumero" class="input-default" placeholder="0123456789" maxlength="10" oninput="validateBankField(this, 'cuenta')">
                                </div>
                            </div>
                        </div>

                        <div data-page="9" class="space-y-4 hidden">
                            <h3><span class="step-icon">9</span> Página 9 - Condiciones</h3>
                            <p class="text-sm text-gray-500">Por favor, lea y acepte las siguientes condiciones.</p>
                            <div class="space-y-3">
                                <div class="flex items-start">
                                    <input id="cond_1" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-1">
                                    <label for="cond_1" class="ml-3 block text-sm text-gray-700">Acepto el tratamiento de mis datos de carácter personal para la tramitación del expediente.</label>
                                </div>
                                <div class="flex items-start">
                                    <input id="cond_2" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-1">
                                    <label for="cond_2" class="ml-3 block text-sm text-gray-700">Autorizo el uso de mis datos para fines administrativos relacionados con la solicitud.</label>
                                </div>
                                <div class="flex items-start">
                                    <input id="cond_3" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-1">
                                    <label for="cond_3" class="ml-3 block text-sm text-gray-700">Declaro que toda la información que figura en esta solicitud es veraz.</label>
                                </div>
                                <div class="flex items-start">
                                    <input id="cond_4" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-1">
                                    <label for="cond_4" class="ml-3 block text-sm text-gray-700">Acepto que la documentación sea enviada al organismo competente de mi Comunidad Autónoma para su valoración.</label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="form-message" class="hidden h-4"></div>

                        <div id="form-navigation">
                            <button type="button" id="prev-btn" onclick="navigatePage(-1)">
                                Atrás
                            </button>
                            <span id="page-indicator" class="hidden"></span>
                            <button type="button" id="next-btn" onclick="navigatePage(1)">
                                Siguiente
                            </button>
                            <button type="submit" id="save-btn" class="hidden">
                                Guardar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div id="admin-view" class="hidden space-y-6">
             <h2 class="text-2xl font-bold text-blue-800 border-b pb-2">Datos Recopilados (Tiempo Real)</h2>

            <div class="flex justify-between items-center mb-4">
                <p class="text-sm text-gray-500">
                    <span class="font-semibold text-gray-700">ID de la Aplicación (Compartir):</span>
                    <span id="app-id-display" class="bg-gray-200 text-gray-800 px-2 py-1 rounded-md text-xs select-all"></span>
                </p>
                <button onclick="exportToCSV()" class="bg-green-600 text-white font-semibold px-4 py-2 rounded-lg shadow hover:bg-green-700 transition-colors duration-200 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    Exportar a CSV (Excel)
                </button>
            </div>

            <div class="overflow-x-auto rounded-lg shadow-md border border-gray-200">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-blue-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-blue-700 uppercase tracking-wider">Últ. Guardado</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-blue-700 uppercase tracking-wider">ID Cliente</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-blue-700 uppercase tracking-wider">Nombre (Inst.)</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-blue-700 uppercase tracking-wider">Email (Inst.)</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-blue-700 uppercase tracking-wider">Teléfono (Inst.)</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-blue-700 uppercase tracking-wider">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body" class="bg-white divide-y divide-gray-100">
                        <tr><td colspan="6" class="text-center py-4 text-gray-500">Cargando datos...</td></tr>
                    </tbody>
                </table>
            </div>
            <p id="data-loading-status" class="text-center text-sm text-gray-500"></p>
        </div>
    </div>

    <div id="message-modal" class="fixed inset-0 modal-overlay hidden items-center justify-center p-4 z-50">
        <div class="modal-box">
            <h3 id="modal-title" class="modal-title"></h3>
            <p id="modal-content" class="modal-content"></p>
            <input type="password" id="modal-input" class="hidden modal-input mb-4" placeholder="Clave de Administrador">
            <div class="modal-actions">
                <button id="modal-cancel-btn" class="hidden" style="background-color: #6b7280;">Cancelar</button>
                <button id="modal-confirm-btn" class="">Aceptar</button>
            </div>
        </div>
    </div>
    
    <footer class="site-footer">
      <span>© DEINCOTEC · Consultoría I+D+i</span>
    </footer>

    <script type="module" src="main.js"></script>
</body>
</html>