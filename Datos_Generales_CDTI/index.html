<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Recopilaci√≥n de Datos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body class="md3-body">

    <!-- Pantalla de Login -->
    <div id="login-screen" class="login-container">
        <div class="login-card">
            <img src="logo-deincotec.png" alt="DEINCOTEC Logo" class="login-logo">
            <h1>Formulario<br>Datos Generales Cliente</h1>
            <p class="login-subtitle" style="text-align: justify;">Introduzca la contrase√±a de acceso proporcionada por
                su consultor:</p>
            <div id="session-warning"
                style="display: none; padding: 0.75rem; margin-bottom: 1rem; background-color: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 0.375rem;">
                <p style="margin: 0; font-size: 0.875rem; color: #92400e;">
                    ‚ö†Ô∏è Ya tiene una sesi√≥n activa. Si desea usar otra contrase√±a, <a href="#"
                        onclick="clearSessionAndReload(event)"
                        style="color: #b45309; text-decoration: underline; font-weight: 600;">haga clic aqu√≠</a> para
                    limpiar la sesi√≥n.
                </p>
            </div>
            <form id="login-form">
                <div class="input-group">
                    <label for="client-password">Contrase√±a de Cliente:</label>
                    <input type="password" id="client-password" name="clientPassword"
                        placeholder="Introduzca su contrase√±a" required>
                </div>
                <button type="submit" class="btn-primary">Acceder al Formulario</button>
                <div id="login-error" class="error-message" style="display: none;"></div>
                <p style="margin-top: 0.75rem; font-size: 0.75rem; color: #6b7280; text-align: center;">
                    üí° Use la contrase√±a proporcionada por su consultor
                </p>
            </form>
            <div style="margin-top: 1.5rem; text-align: center; border-top: 1px solid #e5e7eb; padding-top: 1rem;">
                <p style="margin: 0 0 0.5rem 0; font-size: 0.75rem; color: #9ca3af;">
                    ¬øEs usted administrador?
                </p>
                <button onclick="promptAdminKey()" 
                    style="background: none; border: none; cursor: pointer; color: #6b7280; font-size: 0.875rem; padding: 0.5rem 1rem; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.2s; border-radius: 0.375rem;"
                    onmouseover="this.style.backgroundColor='#f3f4f6'; this.style.color='#374151';"
                    onmouseout="this.style.backgroundColor='transparent'; this.style.color='#6b7280';">
                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">admin_panel_settings</span>
                    Acceso Administrador (Google / Email)
                </button>
            </div>
        </div>
    </div>

    <!-- Aplicaci√≥n Principal (inicialmente oculta) -->
    <div id="app" class="w-full max-w-6xl" style="display: none;">

        <div id="client-view" class="space-y-6">

            <header class="form-header">
                <div class="flex items-center space-x-3">
                    <img src="logo-deincotec.png" alt="DEINCOTEC Logo" class="header-logo">
                    <div class="flex flex-col" style="align-items: flex-start;">
                        <h1 id="main-title" style="margin: 0; line-height: 1.2;">Recopilaci√≥n de Datos del Cliente</h1>
                        <div id="client-info" class="client-badge"
                            style="display: none; align-items: center; gap: 0.5rem; background-color: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; margin-top: 0.25rem; width: fit-content;">
                            <span class="material-symbols-outlined" style="font-size: 1rem;">person</span>
                            <span>Cliente: <strong id="client-id"></strong></span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="show-admin-btn" onclick="promptAdminKey()" disabled
                        style="padding: 0.5rem 1rem; background-color: #d1d5db; color: var(--brand); border-radius: 0.375rem; border: none; font-size: 0.875rem; opacity: 0.5;"
                        title="Inicializando...">Admin</button>
                    <div id="autosave-indicator" class="autosave-status">Autosave activo</div>
                    <button id="logout-btn" onclick="logout()"
                        style="padding: 0.5rem 1rem; background-color: #ef4444; color: white; border-radius: 0.375rem; border: none; font-size: 0.875rem; display: none;">Cerrar
                        Sesi√≥n</button>
                </div>
            </header>

            <div class="progress-header">
                <span id="progress-label">Paso 1 de 9</span>
                <span id="progress-percentage">0%</span>
            </div>
            <div class="progress-bar-container">
                <div id="progress-bar-fill" class="progress-bar-fill" style="width: 0%;"></div>
            </div>
            <div class="form-layout-grid">

                <div class="stepper-column">
                    <nav id="stepper-nav">
                        <ul>
                            <li id="step-1" class="step active">
                                <span class="step-number">1</span>
                                <span class="step-label">Contactos</span>
                            </li>
                            <li id="step-2" class="step">
                                <span class="step-number">2</span>
                                <span class="step-label">Direcci√≥n</span>
                            </li>
                            <li id="step-3" class="step">
                                <span class="step-number">3</span>
                                <span class="step-label">Organizaci√≥n</span>
                            </li>
                            <li id="step-4" class="step">
                                <span class="step-number">4</span>
                                <span class="step-label">Recursos Humanos</span>
                            </li>
                            <li id="step-5" class="step">
                                <span class="step-number">5</span>
                                <span class="step-label">Recursos I+D</span>
                            </li>
                            <li id="step-6" class="step">
                                <span class="step-number">6</span>
                                <span class="step-label">Productos/Servicios</span>
                            </li>
                            <li id="step-7" class="step">
                                <span class="step-number">7</span>
                                <span class="step-label">Tipo Entidad</span>
                            </li>
                            <li id="step-8" class="step">
                                <span class="step-number">8</span>
                                <span class="step-label">Datos Bancarios</span>
                            </li>
                            <li id="step-9" class="step">
                                <span class="step-number">9</span>
                                <span class="step-label">Declaraciones</span>
                            </li>
                            <li id="step-10" class="step">
                                <span class="step-number">10</span>
                                <span class="step-label">Condiciones</span>
                            </li>
                        </ul>
                    </nav>
                </div>

                <div class="content-column">
                    <form id="data-form" onsubmit="event.preventDefault(); saveFormData(true);">

                        <div data-page="1" class="space-y-6">
                            <div class="page-header">
                                <h3>P√°gina 1 - Contactos</h3>
                                <button type="button" class="info-button" onclick="showInfoPopup('page1')"
                                    title="Informaci√≥n sobre esta secci√≥n">
                                    <span class="material-symbols-outlined">info</span>
                                    <span>Ayuda</span>
                                </button>
                            </div>
                            <div id="page1-error-message" class="page-error-message hidden"></div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">
                                    <span class="material-symbols-outlined section-icon">apartment</span>
                                    Contacto Institucional
                                </h4>
                                <div class="form-grid md:grid-cols-2">
                                    <div>
                                        <label for="instNIF">NIF: <span class="text-red-500">*</span></label>
                                        <input type="text" id="instNIF" oninput="validateField(this, 'nif');"
                                            class="input-default" autocomplete="organization">
                                    </div>
                                    <div>
                                        <label for="instNombre">Nombre: <span class="text-red-500">*</span></label>
                                        <input type="text" id="instNombre" oninput="validateField(this, 'required');"
                                            class="input-default" autocomplete="name">
                                    </div>
                                    <div>
                                        <label for="instApellidos">Apellidos: <span
                                                class="text-red-500">*</span></label>
                                        <input type="text" id="instApellidos" oninput="validateField(this, 'required');"
                                            class="input-default" autocomplete="family-name">
                                    </div>
                                    <div>
                                        <label for="instCargo">Cargo: <span class="text-red-500">*</span></label>
                                        <input type="text" id="instCargo" oninput="validateField(this, 'required');"
                                            class="input-default">
                                    </div>
                                    <div>
                                        <label for="instTelefono">Tel√©fono: <span class="text-red-500">*</span></label>
                                        <input type="tel" id="instTelefono" oninput="validatePhoneField(this);"
                                            class="input-default" placeholder="9 d√≠gitos" autocomplete="tel"
                                            inputmode="numeric" maxlength="9">
                                    </div>
                                    <div>
                                        <label for="instEmail">E-Mail: <span class="text-red-500">*</span></label>
                                        <input type="email" id="instEmail" oninput="validateField(this, 'email');"
                                            class="input-default" autocomplete="email">
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">
                                    <span class="material-symbols-outlined section-icon">engineering</span>
                                    Contacto T√©cnico
                                </h4>
                                <div class="form-grid md:grid-cols-3">
                                    <div>
                                        <label for="tecNombre">Nombre: <span class="text-red-500">*</span></label>
                                        <input type="text" id="tecNombre" oninput="validateField(this, 'required');"
                                            class="input-default">
                                    </div>
                                    <div>
                                        <label for="tecApellidos">Apellidos: <span class="text-red-500">*</span></label>
                                        <input type="text" id="tecApellidos" oninput="validateField(this, 'required');"
                                            class="input-default">
                                    </div>
                                    <div>
                                        <label for="tecCargo">Cargo: <span class="text-red-500">*</span></label>
                                        <input type="text" id="tecCargo" oninput="validateField(this, 'required');"
                                            class="input-default">
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">
                                    <span class="material-symbols-outlined section-icon">payments</span>
                                    Contacto Financiero
                                </h4>
                                <div class="form-grid md:grid-cols-3">
                                    <div>
                                        <label for="finNombre">Nombre: <span class="text-red-500">*</span></label>
                                        <input type="text" id="finNombre" oninput="validateField(this, 'required');"
                                            class="input-default">
                                    </div>
                                    <div>
                                        <label for="finApellidos">Apellidos: <span class="text-red-500">*</span></label>
                                        <input type="text" id="finApellidos" oninput="validateField(this, 'required');"
                                            class="input-default">
                                    </div>
                                    <div>
                                        <label for="finCargo">Cargo: <span class="text-red-500">*</span></label>
                                        <input type="text" id="finCargo" oninput="validateField(this, 'required');"
                                            class="input-default">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div data-page="2" class="space-y-4 hidden">
                            <div class="page-header">
                                <h3>P√°gina 2 - Direcci√≥n</h3>
                                <button type="button" class="info-button" onclick="showInfoPopup('page2')"
                                    title="Informaci√≥n sobre esta secci√≥n">
                                    <span class="material-symbols-outlined">info</span>
                                    <span>Ayuda</span>
                                </button>
                            </div>
                            <div id="page2-error-message" class="page-error-message hidden"></div>

                            <!-- Direcci√≥n de Desarrollo -->
                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">Direcci√≥n de Desarrollo</h4>
                                <div class="form-grid md:grid-cols-3">
                                    <div>
                                        <label for="dirTipoVia">Tipo v√≠a: <span class="text-red-500">*</span></label>
                                        <input type="text" id="dirTipoVia" oninput="validateField(this, 'required');"
                                            class="input-default" placeholder="Ej: Calle, Avenida..."
                                            autocomplete="street-address">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="dirDireccion">Direcci√≥n: <span class="text-red-500">*</span></label>
                                        <input type="text" id="dirDireccion" oninput="validateField(this, 'required');"
                                            class="input-default">
                                    </div>
                                    <div>
                                        <label for="dirNumero">N√∫mero: <span class="text-red-500">*</span></label>
                                        <input type="text" id="dirNumero"
                                            oninput="this.value=this.value.replace(/\D/g,''); validateField(this, 'number');"
                                            class="input-default" inputmode="numeric">
                                    </div>
                                    <div>
                                        <label for="dirDatosAdicionales">Datos adicionales Direcci√≥n:</label>
                                        <input type="text" id="dirDatosAdicionales" class="input-default">
                                    </div>
                                    <div>
                                        <label for="dirCP">C. Postal: <span class="text-red-500">*</span></label>
                                        <input type="text" id="dirCP" oninput="handleCPInput(this)"
                                            class="input-default" placeholder="5 d√≠gitos" inputmode="numeric"
                                            maxlength="5" autocomplete="postal-code">
                                    </div>
                                    <div>
                                        <label for="dirProvincia">Provincia: <span class="text-red-500">*</span></label>
                                        <input type="text" id="dirProvincia" readonly>
                                    </div>
                                    <div>
                                        <label for="dirLocalidad">Localidad: <span class="text-red-500">*</span></label>
                                        <input type="text" id="dirLocalidad" readonly>
                                    </div>
                                    <div>
                                        <label for="dirTelefono">Tel√©fono: <span class="text-red-500">*</span></label>
                                        <input type="tel" id="dirTelefono" oninput="validatePhoneField(this);"
                                            class="input-default" placeholder="9 d√≠gitos" autocomplete="tel"
                                            inputmode="numeric" maxlength="9">
                                    </div>
                                    <div>
                                        <label for="dirEmail">E-Mail: <span class="text-red-500">*</span></label>
                                        <input type="email" id="dirEmail" oninput="validateField(this, 'email');"
                                            class="input-default" autocomplete="email">
                                    </div>
                                </div>
                            </div>

                            <!-- Direcci√≥n de Notificaciones -->
                            <div class="form-section">
                                <div class="flex justify-between items-center mb-4" style="margin-bottom: 16px;">
                                    <h4 class="font-semibold text-gray-800" style="margin: 0;">Direcci√≥n de
                                        Notificaciones</h4>
                                    <button type="button" onclick="copyAddressData()"
                                        class="text-sm text-blue-600 hover:text-blue-800 font-medium underline"
                                        style="background: none; border: none; cursor: pointer; color: var(--md-sys-color-primary);">
                                        Igual que direcci√≥n de desarrollo
                                    </button>
                                </div>
                                <div class="form-grid md:grid-cols-3">
                                    <div>
                                        <label for="dirNotifTipoVia">Tipo v√≠a: <span
                                                class="text-red-500">*</span></label>
                                        <input type="text" id="dirNotifTipoVia"
                                            oninput="validateField(this, 'required');" class="input-default"
                                            placeholder="Ej: Calle, Avenida..." autocomplete="street-address">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="dirNotifDireccion">Direcci√≥n: <span
                                                class="text-red-500">*</span></label>
                                        <input type="text" id="dirNotifDireccion"
                                            oninput="validateField(this, 'required');" class="input-default">
                                    </div>
                                    <div>
                                        <label for="dirNotifNumero">N√∫mero: <span class="text-red-500">*</span></label>
                                        <input type="text" id="dirNotifNumero"
                                            oninput="this.value=this.value.replace(/\D/g,''); validateField(this, 'number');"
                                            class="input-default" inputmode="numeric">
                                    </div>
                                    <div>
                                        <label for="dirNotifDatosAdicionales">Datos adicionales Direcci√≥n:</label>
                                        <input type="text" id="dirNotifDatosAdicionales" class="input-default">
                                    </div>
                                    <div>
                                        <label for="dirNotifCP">C. Postal: <span class="text-red-500">*</span></label>
                                        <input type="text" id="dirNotifCP" oninput="handleCPInputNotif(this)"
                                            class="input-default" placeholder="5 d√≠gitos" inputmode="numeric"
                                            maxlength="5" autocomplete="postal-code">
                                    </div>
                                    <div>
                                        <label for="dirNotifProvincia">Provincia: <span
                                                class="text-red-500">*</span></label>
                                        <input type="text" id="dirNotifProvincia" readonly>
                                    </div>
                                    <div>
                                        <label for="dirNotifLocalidad">Localidad: <span
                                                class="text-red-500">*</span></label>
                                        <input type="text" id="dirNotifLocalidad" readonly>
                                    </div>
                                    <div>
                                        <label for="dirNotifTelefono">Tel√©fono: <span
                                                class="text-red-500">*</span></label>
                                        <input type="tel" id="dirNotifTelefono" oninput="validatePhoneField(this);"
                                            class="input-default" placeholder="9 d√≠gitos" autocomplete="tel"
                                            inputmode="numeric" maxlength="9">
                                    </div>
                                    <div>
                                        <label for="dirNotifEmail">E-Mail: <span class="text-red-500">*</span></label>
                                        <input type="email" id="dirNotifEmail" oninput="validateField(this, 'email');"
                                            class="input-default" autocomplete="email">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div data-page="3" class="space-y-4 hidden">
                            <div class="page-header">
                                <h3>P√°gina 3 - Organizaci√≥n</h3>
                                <button type="button" class="info-button" onclick="showInfoPopup('page3')"
                                    title="Informaci√≥n sobre esta secci√≥n">
                                    <span class="material-symbols-outlined">info</span>
                                    <span>Ayuda</span>
                                </button>
                            </div>
                            <div id="page3-error-message" class="page-error-message hidden"></div>

                            <!-- Capital Social (se mantiene tal cual) -->
                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">Capital Social (√öltimo a√±o)</h4>
                                <div class="form-grid md:grid-cols-2">
                                    <div>
                                        <label for="orgAnoCapital">A√±o Capital Social: <span
                                                class="text-red-500">*</span></label>
                                        <select id="orgAnoCapital" class="input-default">
                                            <option value="">-- Seleccione --</option>
                                            <option value="2023">2023</option>
                                            <option value="2024">2024</option>
                                            <option value="2025">2025</option>
                                            <option value="2026">2026</option>
                                            <option value="2027">2027</option>
                                            <option value="2028">2028</option>
                                            <option value="2029">2029</option>
                                            <option value="2030">2030</option>
                                            <option value="2031">2031</option>
                                            <option value="2032">2032</option>
                                            <option value="2033">2033</option>
                                            <option value="2034">2034</option>
                                            <option value="2035">2035</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="orgCapitalSocial">Capital Social (‚Ç¨): <span
                                                class="text-red-500">*</span></label>
                                        <input type="text" id="orgCapitalSocial" oninput="validateCurrencyField(this);"
                                            class="input-default" placeholder="Ej: 50.000,00" inputmode="decimal">
                                    </div>
                                </div>
                            </div>

                            <!-- Composici√≥n Accionarial -->
                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">Composici√≥n Accionarial</h4>
                                <div id="accionarial-container">
                                    <div class="accionarial-grupo form-grid md:grid-cols-2"
                                        style="background-color: var(--card); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                                        <div>
                                            <label for="acc_1_nombre">Nombre / Raz√≥n Social: <span
                                                    class="text-red-500">*</span></label>
                                            <input id="acc_1_nombre" type="text" class="input-default">
                                        </div>
                                        <div>
                                            <label for="acc_1_cif">CIF: <span class="text-red-500">*</span></label>
                                            <input id="acc_1_cif" type="text" class="input-default">
                                        </div>
                                        <div style="position: relative;">
                                            <label for="acc_1_pct">% Participaci√≥n: <span
                                                    class="text-red-500">*</span></label>
                                            <input id="acc_1_pct" type="number" step="0.1" class="input-default"
                                                oninput="validatePercentageField(this)">
                                        </div>
                                        <div>
                                            <label for="acc_1_pyme">Pyme: <span class="text-red-500">*</span></label>
                                            <select id="acc_1_pyme" class="input-default">
                                                <option value="">--</option>
                                                <option value="S√≠">S√≠</option>
                                                <option value="No">No</option>
                                                <option value="No aplica">No aplica</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="acc_1_nacionalidad">Nacionalidad: <span
                                                    class="text-red-500">*</span></label>
                                            <input id="acc_1_nacionalidad" type="text" class="input-default">
                                        </div>
                                    </div>
                                </div>
                                <button type="button" onclick="addAccionarialGrupo()" class="mt-4"
                                    style="background-color: var(--accent); color: white; padding: 0.6rem 1.2rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; transition: background-color 0.2s ease;"
                                    onmouseover="this.style.backgroundColor='var(--accent-2)'"
                                    onmouseout="this.style.backgroundColor='var(--accent)'">
                                    <span style="color: white;">+</span> A√±adir Accionista
                                </button>
                            </div>

                            <!-- Consejo -->
                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">Composici√≥n del Consejo de Administraci√≥n</h4>
                                <div id="consejo-container">
                                    <div class="consejo-grupo form-grid md:grid-cols-2"
                                        style="background-color: var(--card); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                                        <div>
                                            <label for="consejo_1_nombre">Nombre: <span
                                                    class="text-red-500">*</span></label>
                                            <input id="consejo_1_nombre" type="text" class="input-default">
                                        </div>
                                        <div>
                                            <label for="consejo_1_dni">NIF/CIF: <span
                                                    class="text-red-500">*</span></label>
                                            <input id="consejo_1_dni" type="text" class="input-default">
                                        </div>
                                        <div>
                                            <label for="consejo_1_cargo">Cargo: <span
                                                    class="text-red-500">*</span></label>
                                            <input id="consejo_1_cargo" type="text" class="input-default">
                                        </div>
                                        <div>
                                            <label for="consejo_1_nacionalidad">Nacionalidad: <span
                                                    class="text-red-500">*</span></label>
                                            <input id="consejo_1_nacionalidad" type="text" class="input-default">
                                        </div>
                                    </div>
                                </div>
                                <button type="button" onclick="addConsejoGrupo()" class="mt-4"
                                    style="background-color: var(--accent); color: white; padding: 0.6rem 1.2rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; transition: background-color 0.2s ease;"
                                    onmouseover="this.style.backgroundColor='var(--accent-2)'"
                                    onmouseout="this.style.backgroundColor='var(--accent)'">
                                    <span style="color: white;">+</span> A√±adir Miembro
                                </button>
                            </div>

                            <!-- Filiales -->
                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">Filiales</h4>
                                <div id="filial-container">
                                    <div class="filial-grupo form-grid md:grid-cols-2"
                                        style="background-color: var(--card); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                                        <div>
                                            <label for="filial_1_razon">Raz√≥n Social:</label>
                                            <input id="filial_1_razon" type="text" class="input-default">
                                        </div>
                                        <div>
                                            <label for="filial_1_cif">CIF:</label>
                                            <input id="filial_1_cif" type="text" class="input-default">
                                        </div>
                                        <div>
                                            <label for="filial_1_actividad">Actividad Principal:</label>
                                            <input id="filial_1_actividad" type="text" class="input-default">
                                        </div>
                                        <div>
                                            <label for="filial_1_pct">% Participaci√≥n:</label>
                                            <input id="filial_1_pct" type="number" step="0.1" class="input-default">
                                        </div>
                                        <div>
                                            <label for="filial_1_pais">Pa√≠s:</label>
                                            <input id="filial_1_pais" type="text" class="input-default">
                                        </div>
                                    </div>
                                </div>
                                <button type="button" onclick="addFilialGrupo()" class="mt-4"
                                    style="background-color: var(--accent); color: white; padding: 0.6rem 1.2rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; transition: background-color 0.2s ease;"
                                    onmouseover="this.style.backgroundColor='var(--accent-2)'"
                                    onmouseout="this.style.backgroundColor='var(--accent)'">
                                    <span style="color: white;">+</span> A√±adir Filial
                                </button>
                            </div>

                        </div>

                        <!-- P√°gina 4: Recursos Humanos - ser√° generado din√°micamente por JS -->
                        <div data-page="4" class="space-y-4 hidden">
                            <div class="page-header">
                                <h3>P√°gina 4 - Recursos Humanos</h3>
                                <button type="button" class="info-button" onclick="showInfoPopup('page4')"
                                    title="Informaci√≥n sobre esta secci√≥n">
                                    <span class="material-symbols-outlined">info</span>
                                    <span>Ayuda</span>
                                </button>
                            </div>
                            <div id="page4-error-message" class="page-error-message hidden"></div>
                            <div id="recursos-container" class="space-y-4"></div>
                        </div>

                        <div data-page="5" class="space-y-4 hidden">
                            <div class="page-header">
                                <h3>P√°gina 5 - Recursos I+D</h3>
                                <button type="button" class="info-button" onclick="showInfoPopup('page5')"
                                    title="Informaci√≥n sobre esta secci√≥n">
                                    <span class="material-symbols-outlined">info</span>
                                    <span>Ayuda</span>
                                </button>
                            </div>
                            <p class="text-sm text-gray-500">Indique los recursos destinados a I+D (hist√≥rico y
                                previstos).</p>

                            <div id="recursos-id-container" class="overflow-x-auto">
                                <!-- La tabla se generar√° din√°micamente aqu√≠ -->
                            </div>
                        </div>

                        <div data-page="6" class="space-y-4 hidden">
                            <div class="page-header">
                                <h3>P√°gina 6 - Productos/Servicios</h3>
                                <button type="button" class="info-button" onclick="showInfoPopup('page6')"
                                    title="Informaci√≥n sobre esta secci√≥n">
                                    <span class="material-symbols-outlined">info</span>
                                    <span>Ayuda</span>
                                </button>
                            </div>
                            <div id="page6-error-message" class="page-error-message hidden"></div>

                            <div id="productos-container" class="space-y-4">
                                <!-- Los productos se renderizan din√°micamente aqu√≠ -->
                            </div>

                            <button type="button" onclick="addProductoGrupo()" class="btn-add"
                                style="background-color: var(--accent); color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 600; cursor: pointer; border: none;">
                                + A√±adir Producto/Servicio
                            </button>
                        </div>

                        <div data-page="7" class="space-y-4 hidden">
                            <div class="page-header">
                                <h3>P√°gina 7 - Tipo de Entidad</h3>
                                <button type="button" class="info-button" onclick="showInfoPopup('page7')"
                                    title="Informaci√≥n sobre esta secci√≥n">
                                    <span class="material-symbols-outlined">info</span>
                                    <span>Ayuda</span>
                                </button>
                            </div>
                            <div id="page7-error-message" class="page-error-message hidden"></div>

                            <div class="form-grid md:grid-cols-2">
                                <div>
                                    <label for="entidadTipo">Tipo de Entidad:</label>
                                    <select id="entidadTipo" class="input-default">
                                        <option value="">-- Seleccione --</option>
                                        <option value="Autonoma">Empresa Aut√≥noma</option>
                                        <option value="Asociada">Empresa Asociada</option>
                                        <option value="Vinculada">Empresa Vinculada</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="entidadTama√±o">Tama√±o Entidad:</label>
                                    <select id="entidadTama√±o" class="input-default">
                                        <option value="">-- Seleccione --</option>
                                        <option value="Peque√±a">Peque√±a Empresa</option>
                                        <option value="Mediana">Mediana Empresa</option>
                                        <option value="Grande">Gran Empresa</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="entidadPeriodoRef">Periodo de Referencia:</label>
                                    <select id="entidadPeriodoRef" class="input-default"
                                        onchange="actualizarEjercicioAnterior()">
                                        <option value="">-- Seleccione --</option>
                                        <option value="2023">2023</option>
                                        <option value="2024">2024</option>
                                        <option value="2025">2025</option>
                                        <option value="2026">2026</option>
                                        <option value="2027">2027</option>
                                        <option value="2028">2028</option>
                                        <option value="2029">2029</option>
                                        <option value="2030">2030</option>
                                        <option value="2031">2031</option>
                                        <option value="2032">2032</option>
                                        <option value="2033">2033</option>
                                        <option value="2034">2034</option>
                                        <option value="2035">2035</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-section" style="margin-top: 2rem;">
                                <h4 class="font-semibold text-gray-800">Datos √∫ltimo ejercicio cerrado</h4>
                                <div class="form-grid md:grid-cols-3">
                                    <div>
                                        <label for="ent_efectivos">Efectivos (UTA):</label>
                                        <input type="text" id="ent_efectivos" class="input-default"
                                            oninput="validateIntegerField(this)">
                                    </div>
                                    <div>
                                        <label for="ent_volumen_negocio">Volumen de Negocio (‚Ç¨):</label>
                                        <input type="text" id="ent_volumen_negocio" class="input-default"
                                            oninput="validateCurrencyField(this)" placeholder="Ej: 1.500.000,00">
                                    </div>
                                    <div>
                                        <label for="ent_balance_general">Balance General (‚Ç¨):</label>
                                        <input type="text" id="ent_balance_general" class="input-default"
                                            oninput="validateCurrencyField(this)" placeholder="Ej: 2.000.000,00">
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800" id="ejercicioAnteriorTitle">Ejercicio anterior
                                </h4>
                                <div class="form-grid md:grid-cols-3">
                                    <div>
                                        <label for="ent_anterior_efectivos">Efectivos (UTA):</label>
                                        <input type="text" id="ent_anterior_efectivos" class="input-default"
                                            oninput="validateIntegerField(this)">
                                    </div>
                                    <div>
                                        <label for="ent_anterior_volumen_negocio">Volumen de Negocio (‚Ç¨):</label>
                                        <input type="text" id="ent_anterior_volumen_negocio" class="input-default"
                                            oninput="validateCurrencyField(this)" placeholder="Ej: 1.500.000,00">
                                    </div>
                                    <div>
                                        <label for="ent_anterior_balance_general">Balance General (‚Ç¨):</label>
                                        <input type="text" id="ent_anterior_balance_general" class="input-default"
                                            oninput="validateCurrencyField(this)" placeholder="Ej: 2.000.000,00">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div data-page="8" class="space-y-4 hidden">
                            <div class="page-header">
                                <h3>P√°gina 8 - Datos Bancarios</h3>
                                <button type="button" class="info-button" onclick="showInfoPopup('page8')"
                                    title="Informaci√≥n sobre esta secci√≥n">
                                    <span class="material-symbols-outlined">info</span>
                                    <span>Ayuda</span>
                                </button>
                            </div>
                            <div class="form-grid md:grid-cols-3">
                                <div class="md:col-span-3">
                                    <label for="bankIBAN">IBAN:</label>
                                    <input type="text" id="bankIBAN" class="input-default" placeholder="ES00"
                                        maxlength="4" oninput="validateBankField(this, 'iban')">
                                </div>
                                <div>
                                    <label for="bankEntidad">Entidad:</label>
                                    <input type="text" id="bankEntidad" class="input-default" placeholder="1234"
                                        maxlength="4" oninput="validateBankField(this, 'entidad')">
                                </div>
                                <div>
                                    <label for="bankOficina">Oficina:</label>
                                    <input type="text" id="bankOficina" class="input-default" placeholder="5678"
                                        maxlength="4" oninput="validateBankField(this, 'oficina')">
                                </div>
                                <div>
                                    <label for="bankDC">DC:</label>
                                    <input type="text" id="bankDC" class="input-default" placeholder="90" maxlength="2"
                                        oninput="validateBankField(this, 'dc')">
                                </div>
                                <div class="md:col-span-3">
                                    <label for="bankNumero">N√∫mero de Cuenta:</label>
                                    <input type="text" id="bankNumero" class="input-default" placeholder="0123456789"
                                        maxlength="10" oninput="validateBankField(this, 'cuenta')">
                                </div>
                            </div>
                        </div>

                        <div data-page="9" class="space-y-4 hidden">
                            <div class="page-header">
                                <h3>P√°gina 9 - Declaraciones</h3>
                                <button type="button" class="info-button" onclick="showInfoPopup('page9')"
                                    title="Informaci√≥n sobre esta secci√≥n">
                                    <span class="material-symbols-outlined">info</span>
                                    <span>Ayuda</span>
                                </button>
                            </div>

                            <p class="text-sm text-gray-500">Por favor, complete las siguientes declaraciones
                                obligatorias.</p>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">DECLARACI√ìN DE AYUDAS</h4>
                                <div class="space-y-4">
                                    <div class="decl-select-row">
                                        <label class="decl-select-label">¬øLa entidad ha solicitado u obtenido alg√∫n tipo
                                            de ayuda de cualquier Administraci√≥n o ente p√∫blico o privado, nacional, o
                                            internacional, en relaci√≥n con el proyecto o actuaci√≥n objeto de esta
                                            solicitud?</label>
                                        <select id="decl_ayuda_solicitada" class="decl-select-input">
                                            <option value="">-- Seleccione --</option>
                                            <option value="Si">S√≠</option>
                                            <option value="No">No</option>
                                        </select>
                                    </div>
                                    <div class="decl-select-row">
                                        <label class="decl-select-label">¬øLa entidad ha solicitado u obtenido, en
                                            relaci√≥n con el proyecto o actuaci√≥n objeto de esta solicitud, alguna ayuda
                                            privada cuyas fuentes de financiaci√≥n o de otorgamiento de garant√≠a o
                                            reafianzamiento est√°n financiadas por cualquier Fondo proveniente del
                                            Presupuesto de la Uni√≥n Europea (Fondos Estructurales, de Inversi√≥n Europeos
                                            u otros de naturaleza comunitaria)?</label>
                                        <select id="decl_ayuda_europea" class="decl-select-input">
                                            <option value="">-- Seleccione --</option>
                                            <option value="Si">S√≠</option>
                                            <option value="No">No</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">ENTIDAD EN CRISIS</h4>
                                <div class="decl-select-row">
                                    <label class="decl-select-label">Consideraci√≥n de entidad en crisis, seg√∫n la
                                        definici√≥n del art√≠culo 2, apartado 18, del Reglamento (UE) n¬∫ 651/2014, de la
                                        Comisi√≥n del 17 de junio de 2014 (*).</label>
                                    <select id="decl_entidad_crisis" class="decl-select-input">
                                        <option value="">-- Seleccione --</option>
                                        <option value="Si">S√≠</option>
                                        <option value="No">No</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">OTRAS DECLARACIONES</h4>
                                <div class="space-y-3">
                                    <!-- Checkbox general para seleccionar todos -->
                                    <label class="decl-checkbox-row" style="background-color: #e8f5e9; border: 2px solid #4caf50; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                                        <span class="decl-checkbox-label" style="font-weight: 600; color: #2e7d32;">
                                            ‚úì Seleccionar todas las declaraciones de esta secci√≥n
                                        </span>
                                        <input type="checkbox" id="decl_select_all_otras" class="decl-checkbox-input" style="width: 20px; height: 20px;">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante cumple los requisitos
                                            establecidos en la presente convocatoria para resultar beneficiario de las
                                            ayudas contempladas en la misma.</span>
                                        <input type="checkbox" id="decl_cumple_requisitos" class="decl-checkbox-input otras-declaraciones-item">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">No ha iniciado las actividades
                                            correspondientes al proyecto antes de la presentaci√≥n de la solicitud de
                                            ayuda a CDTI.</span>
                                        <input type="checkbox" id="decl_no_inicio_previo" class="decl-checkbox-input otras-declaraciones-item">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante cumplir√° con la normativa
                                            comunitaria, nacional y, en su caso, auton√≥mica o local que le
                                            afecte.</span>
                                        <input type="checkbox" id="decl_cumple_normativa" class="decl-checkbox-input otras-declaraciones-item">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante declara que estar√° sujeto a las
                                            actuaciones de control que lleven a cabo las instituciones facultadas para
                                            ello.</span>
                                        <input type="checkbox" id="decl_sujeto_control" class="decl-checkbox-input otras-declaraciones-item">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">La empresa declara que la entidad que figura
                                            como solicitante de la ayuda en la presente convocatoria act√∫a como
                                            representante de la agrupaci√≥n que desarrollar√° el proyecto objeto de la
                                            presente solicitud.</span>
                                        <input type="checkbox" id="decl_representante_agrupacion"
                                            class="decl-checkbox-input otras-declaraciones-item">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante declara que el proyecto
                                            presentado respeta el principio DNSH.</span>
                                        <input type="checkbox" id="decl_respeta_dnsh" class="decl-checkbox-input otras-declaraciones-item">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">No tiene deudas por reintegro de ayudas,
                                            prestamos o anticipos con la Administraci√≥n.</span>
                                        <input type="checkbox" id="decl_no_deudas" class="decl-checkbox-input otras-declaraciones-item">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante autoriza la cesi√≥n y
                                            tratamiento de datos entre las Administraciones P√∫blicas implicadas.</span>
                                        <input type="checkbox" id="decl_autoriza_cesion_datos"
                                            class="decl-checkbox-input otras-declaraciones-item">
                                    </label>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">CUMPLIMIENTO FEDER</h4>
                                <div class="space-y-3">
                                    <!-- Checkbox general para seleccionar todos -->
                                    <label class="decl-checkbox-row" style="background-color: #e8f5e9; border: 2px solid #4caf50; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                                        <span class="decl-checkbox-label" style="font-weight: 600; color: #2e7d32;">
                                            ‚úì Seleccionar todas las declaraciones de esta secci√≥n
                                        </span>
                                        <input type="checkbox" id="decl_select_all_feder" class="decl-checkbox-input" style="width: 20px; height: 20px;">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante declara que los gastos de
                                            personal imputados al proyecto corresponden a personal dado de alta en alg√∫n
                                            centro de trabajo ubicado en una de las Comunidades Aut√≥nomas de desarrollo
                                            previstas en la presente convocatoria.</span>
                                        <input type="checkbox" id="decl_feder_personal_ca" class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante es conocedor de las medidas y
                                            las condiciones obligatorias que deber√° cumplir si aceptase la ayuda.</span>
                                        <input type="checkbox" id="decl_feder_conoce_condiciones"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante confirma que tiene capacidad
                                            administrativa, financiera y operativa para cumplir las condiciones
                                            enumeradas con anterioridad, y disponibilidad presupuestaria para afrontar
                                            la inversi√≥n total prevista.</span>
                                        <input type="checkbox" id="decl_feder_capacidad" class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante cumplir√° con lo dispuesto en
                                            los art√≠culos 46, 47, 49, 50 y en el Anexo IX del Reglamento (UE) n¬∫
                                            1060/2021.</span>
                                        <input type="checkbox" id="decl_feder_cumple_reglamento"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante se compromete a observar
                                            estrictamente la normativa aplicable en materia de publicidad de los Fondos
                                            Estructurales.</span>
                                        <input type="checkbox" id="decl_feder_publicidad" class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante da su consentimiento para que
                                            los materiales de comunicaci√≥n y visibilidad del proyecto se pongan a
                                            disposici√≥n de las instituciones de la Uni√≥n.</span>
                                        <input type="checkbox" id="decl_feder_licencia_ue" class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante es conocedor que la minoraci√≥n
                                            de la ayuda prevista en el art√≠culo 50.3 del Reglamento (UE) n¬∫ 1060/2021 no
                                            supone la exenci√≥n de la aplicaci√≥n de las causas de reintegro.</span>
                                        <input type="checkbox" id="decl_feder_conoce_minoracion"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante declara que la operaci√≥n objeto
                                            de ayuda no ha concluido materialmente o no se ha ejecutado √≠ntegramente
                                            antes de la fecha de presentaci√≥n de la solicitud de ayuda.</span>
                                        <input type="checkbox" id="decl_feder_operacion_no_concluida"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante se compromete a conservar todos
                                            los documentos justificativos relacionados con una operaci√≥n durante un
                                            plazo de cinco a√±os.</span>
                                        <input type="checkbox" id="decl_feder_conservar_docs"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante declara que est√° informado de
                                            la obligaci√≥n de mantener registros contables independientes o a utilizar
                                            c√≥digos de contabilidad apropiados.</span>
                                        <input type="checkbox" id="decl_feder_registros_contables"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante declara que conoce la
                                            declaraci√≥n institucional en materia antifraude de la Autoridad de
                                            Gesti√≥n.</span>
                                        <input type="checkbox" id="decl_feder_conoce_antifraude"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante declara estar informado de las
                                            medidas antifraude que como beneficiario p√∫blico debe adoptar.</span>
                                        <input type="checkbox" id="decl_feder_informado_medidas"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante se compromete a difundir en su
                                            organizaci√≥n el comunicado sobre conocimiento de hechos que pudieran ser
                                            constitutivos de fraude.</span>
                                        <input type="checkbox" id="decl_feder_difundir_comunicado"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante asume los compromisos de
                                            durabilidad y reubicaci√≥n, establecidos en el art√≠culo 65, el art√≠culo 66, y
                                            el art√≠culo 73, apartado 2, letra h) del Reglamento (UE) n¬∫
                                            1060/2021.</span>
                                        <input type="checkbox" id="decl_feder_durabilidad" class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante est√° informado de la obligaci√≥n
                                            de facilitar la informaci√≥n pertinente en relaci√≥n con el cumplimiento de
                                            los indicadores de realizaci√≥n y resultados.</span>
                                        <input type="checkbox" id="decl_feder_indicadores" class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante estar√° a disposici√≥n de los
                                            √≥rganos competentes estatales o comunitarios para verificaci√≥n.</span>
                                        <input type="checkbox" id="decl_feder_comprobacion" class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante acepta las obligaciones
                                            contempladas en el art√≠culo 129 del Reglamento (UE, Euratom) 2018/1046 en
                                            relaci√≥n a la cooperaci√≥n en la defensa de los intereses financieros de la
                                            Uni√≥n.</span>
                                        <input type="checkbox" id="decl_feder_cooperacion" class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante es conocedor de la posibilidad
                                            de que la Autoridad de Gesti√≥n utilice la informaci√≥n comunicada para
                                            efectuar an√°lisis de riesgos.</span>
                                        <input type="checkbox" id="decl_feder_analisis_riesgos"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante declara que conoce que la
                                            conformidad de la aceptaci√≥n de la ayuda supone figurar como beneficiario en
                                            la lista de operaciones cofinanciadas.</span>
                                        <input type="checkbox" id="decl_feder_lista_operaciones"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante declara que en cumplimiento del
                                            art√≠culo 73 del Reglamento (UE) n¬∫ 1060/2021, en la ejecuci√≥n de la
                                            operaci√≥n se garantizar√° la accesibilidad a las personas con
                                            discapacidad.</span>
                                        <input type="checkbox" id="decl_feder_accesibilidad"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El solicitante autoriza al CDTI a facilitar
                                            estas declaraciones de responsabilidad a la Autoridad de Gesti√≥n del
                                            FEDER.</span>
                                        <input type="checkbox" id="decl_feder_autoriza_facilitar"
                                            class="decl-checkbox-input">
                                    </label>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">LISTA COMPROBACI√ìN EMPRESA</h4>
                                <div class="space-y-4">
                                    <div class="decl-select-row">
                                        <label class="decl-select-label">¬øHa elaborado la empresa que solicita la ayuda
                                            un plan de igualdad de mujeres y hombres?</label>
                                        <select id="decl_plan_igualdad" class="decl-select-input">
                                            <option value="">-- Seleccione --</option>
                                            <option value="Si">S√≠</option>
                                            <option value="No">No</option>
                                            <option value="No Aplica">No Aplica</option>
                                        </select>
                                    </div>
                                    <div class="decl-select-row">
                                        <label class="decl-select-label">¬øDispone la empresa de un protocolo que recoge
                                            medidas espec√≠ficas para prevenir el acoso sexual?</label>
                                        <select id="decl_protocolo_acoso" class="decl-select-input">
                                            <option value="">-- Seleccione --</option>
                                            <option value="Si">S√≠</option>
                                            <option value="No">No</option>
                                            <option value="No Aplica">No Aplica</option>
                                        </select>
                                    </div>
                                    <div class="decl-select-row">
                                        <label class="decl-select-label">¬øPosee la empresa el distintivo empresarial
                                            para la igualdad efectiva de mujeres y hombres?</label>
                                        <select id="decl_distintivo_igualdad" class="decl-select-input">
                                            <option value="">-- Seleccione --</option>
                                            <option value="Si">S√≠</option>
                                            <option value="No">No</option>
                                        </select>
                                    </div>
                                    <div class="decl-select-row">
                                        <label class="decl-select-label">¬øHa puesto en marcha la empresa medidas de
                                            conciliaci√≥n de la vida personal, laboral y familiar?</label>
                                        <select id="decl_medidas_conciliacion" class="decl-select-input">
                                            <option value="">-- Seleccione --</option>
                                            <option value="Si">S√≠</option>
                                            <option value="No">No</option>
                                        </select>
                                    </div>
                                    <div class="decl-select-row">
                                        <label class="decl-select-label">¬øCumple la empresa con la obligaci√≥n de reserva
                                            de al menos el 2% de los puestos de trabajo destinados a personas con
                                            discapacidad?</label>
                                        <select id="decl_reserva_discapacidad" class="decl-select-input">
                                            <option value="">-- Seleccione --</option>
                                            <option value="Si">S√≠</option>
                                            <option value="No">No</option>
                                            <option value="No Aplica">No Aplica</option>
                                        </select>
                                    </div>
                                    <div class="decl-select-row">
                                        <label class="decl-select-label">¬øTiene la empresa establecidas medidas de
                                            accesibilidad a las instalaciones y/o a los puestos de trabajo para sus
                                            empleados con discapacidad?</label>
                                        <select id="decl_accesibilidad_instalaciones" class="decl-select-input">
                                            <option value="">-- Seleccione --</option>
                                            <option value="Si">S√≠</option>
                                            <option value="No">No</option>
                                        </select>
                                    </div>
                                    <div class="decl-select-row">
                                        <label class="decl-select-label">¬øLa actividad empresarial tiene impacto
                                            positivo con el desarrollo sostenible, conservaci√≥n, protecci√≥n y mejora del
                                            medio ambiente?</label>
                                        <select id="decl_impacto_medioambiental" class="decl-select-input">
                                            <option value="">-- Seleccione --</option>
                                            <option value="Si">S√≠</option>
                                            <option value="No">No</option>
                                        </select>
                                    </div>
                                    <div class="decl-select-row">
                                        <label class="decl-select-label">¬øEl responsable principal de la propuesta es
                                            una mujer?</label>
                                        <select id="decl_responsable_mujer" class="decl-select-input">
                                            <option value="">-- Seleccione --</option>
                                            <option value="Si">S√≠</option>
                                            <option value="No">No</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">LISTA COMPROBACI√ìN PROYECTO</h4>
                                <div class="space-y-3">
                                    <!-- Checkbox general para seleccionar todos -->
                                    <label class="decl-checkbox-row" style="background-color: #e8f5e9; border: 2px solid #4caf50; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                                        <span class="decl-checkbox-label" style="font-weight: 600; color: #2e7d32;">
                                            ‚úì Seleccionar todas las declaraciones de esta secci√≥n
                                        </span>
                                        <input type="checkbox" id="decl_select_all_proyecto" class="decl-checkbox-input" style="width: 20px; height: 20px;">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">En el caso de que la operaci√≥n sea un proyecto
                                            o incluya alguna parte que responda a la definici√≥n del art√≠culo 5, apartado
                                            3b de la Ley 21/2013, cuenta con las autorizaciones que fueren
                                            pertinentes.</span>
                                        <input type="checkbox" id="decl_proy_autorizaciones"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">¬øSe cumplen el resto de las normas
                                            medioambientales nacionales y comunitarias?</span>
                                        <input type="checkbox" id="decl_proy_normas_ambientales"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">¬øSe cumplen las normas nacionales y
                                            comunitarias sobre desarrollo sostenible?</span>
                                        <input type="checkbox" id="decl_proy_desarrollo_sostenible"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">¬øEl proyecto a desarrollar contiene una
                                            dimensi√≥n de g√©nero por sus objetivos, plan de trabajo, tecnolog√≠as
                                            aplicadas o desarrolladas, resultados o aplicaciones?</span>
                                        <input type="checkbox" id="decl_proy_dimension_genero"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">¬øLos resultados del proyecto tienen un impacto
                                            positivo sobre la igualdad de g√©nero?</span>
                                        <input type="checkbox" id="decl_proy_impacto_genero"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">¬øEl desarrollo del proyecto procura eliminar
                                            las desigualdades y promover la igualdad entre hombres y mujeres?</span>
                                        <input type="checkbox" id="decl_proy_eliminar_desigualdades"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">¬øEl desarrollo del proyecto lucha contra la
                                            discriminaci√≥n por raz√≥n de sexo, raza u origen √©tnico, religi√≥n o
                                            convicciones, discapacidad, edad u orientaci√≥n sexual?</span>
                                        <input type="checkbox" id="decl_proy_lucha_discriminacion"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">La agrupaci√≥n declara su conformidad para
                                            acceder a una ayuda parcialmente reembolsable, en los t√©rminos previstos en
                                            el art√≠culo 24 de la convocatoria.</span>
                                        <input type="checkbox" id="decl_proy_ayuda_reembolsable"
                                            class="decl-checkbox-input">
                                    </label>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">CUMPLIMIENTO FEDER PROYECTO</h4>
                                <div class="space-y-3">
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">Las actividades y tecnolog√≠a asociada al
                                            proyecto son susceptibles de cofinanciar con FEDER 21-27.</span>
                                        <input type="checkbox" id="decl_feder_proy_susceptible_cofinanciar"
                                            class="decl-checkbox-input">
                                    </label>
                                    <label class="decl-checkbox-row">
                                        <span class="decl-checkbox-label">El proyecto es de uso civil (No podr√°n ser
                                            cofinanciados con FEDER proyectos de uso dual o militar).</span>
                                        <input type="checkbox" id="decl_feder_proy_uso_civil"
                                            class="decl-checkbox-input">
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div data-page="10" class="space-y-4 hidden">
                            <div class="page-header">
                                <h3>P√°gina 10 - Condiciones</h3>
                                <button type="button" class="info-button" onclick="showInfoPopup('page10')"
                                    title="Informaci√≥n sobre esta secci√≥n">
                                    <span class="material-symbols-outlined">info</span>
                                    <span>Ayuda</span>
                                </button>
                            </div>

                            <p class="text-sm text-gray-500">Por favor, lea y acepte las siguientes condiciones.</p>

                            <div
                                style="padding: 1rem; background-color: #f0fdf4; border: 2px solid #86efac; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                                <label for="acceptAllConditions"
                                    style="display: flex; align-items: center; gap: 1rem; cursor: pointer;">
                                    <input id="acceptAllConditions" type="checkbox"
                                        style="width: 1.5rem; height: 1.5rem; cursor: pointer;"
                                        class="text-green-600 border-gray-300 rounded focus:ring-green-500"
                                        onchange="validatePage10()">
                                    <span class="text-base font-semibold text-gray-800">Acepto todas las
                                        condiciones</span>
                                </label>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">Condiciones Presentaci√≥n Empresa</h4>
                                <div class="space-y-4">
                                    <div class="text-sm text-gray-700"
                                        style="text-align: justify; padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb;">
                                        <strong>1. Estoy informado/a de las condiciones FEDER:</strong> He le√≠do las
                                        caracter√≠sticas de este tipo de ayudas y las obligaciones inherentes a la
                                        financiaci√≥n FEDER. Estas modalidades de proyectos se apoyan con Ayudas
                                        Parcialmente Reembolsables cofinanciadas por Fondo Europeo de Desarrollo
                                        Regional (FEDER). Si su proyecto recibe finalmente cofinanciaci√≥n FEDER, deber√°
                                        aceptar, como beneficiario, determinadas obligaciones. Si desea acceder a la
                                        solicitud electr√≥nica ha de leer y darse por informado de las caracter√≠sticas y
                                        obligaciones inherentes a la financiaci√≥n FEDER.
                                    </div>

                                    <div class="text-sm text-gray-700"
                                        style="text-align: justify; padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb;">
                                        <strong>2. Tratamiento de datos de car√°cter personal:</strong><br><br>
                                        Los datos de car√°cter personal asociados al expediente ser√°n tratados por el
                                        CDTI con la finalidad de llevar a cabo la tramitaci√≥n del expediente as√≠ como el
                                        control de la ayuda concedida, en su caso. Tales datos personales tienen
                                        car√°cter necesario y su no presentaci√≥n determinar√° la imposibilidad de
                                        continuar con el procedimiento.<br><br>
                                        CDTI est√° legitimado para el tratamiento de los datos en virtud de la Ley
                                        14/2011, de 1 de junio, de la Ciencia, la Tecnolog√≠a y la Innovaci√≥n, que lo
                                        designa como agente de financiaci√≥n del Sistema Espa√±ol de Ciencia, Tecnolog√≠a e
                                        Innovaci√≥n.<br><br>
                                        Los datos ser√°n protegidos y conservados conforme a lo dispuesto en el
                                        Reglamento (UE) 2016/679 del Parlamento Europeo y del Consejo, de 27 de abril de
                                        2016, y resto de normativa aplicable durante los plazos establecidos en la
                                        normativa reguladora de la ayuda.<br><br>
                                        El CDTI realizar√° cesiones de datos a las Administraciones P√∫blicas, a las
                                        entidades y sujetos que estipule la Ley. Asimismo, las entidades que colaboren
                                        con CDTI en la evaluaci√≥n del presente proyecto podr√°n tener acceso a tales
                                        datos personales con la √∫nica y exclusiva finalidad de realizar la referida
                                        evaluaci√≥n.<br><br>
                                        En el proceso de evaluaci√≥n del proyecto, el CDTI podr√° solicitar la
                                        colaboraci√≥n de otras entidades. Acepto que se env√≠e la documentaci√≥n de la
                                        propuesta a estas entidades para la realizaci√≥n del informe de
                                        valoraci√≥n.<br><br>
                                        El titular de los datos podr√° ejercer los derechos de acceso, rectificaci√≥n y
                                        supresi√≥n, de limitaci√≥n del tratamiento y de oposici√≥n a trav√©s de los medios
                                        indicados en la p√°gina web del CDTI ("aviso legal"). Igualmente tendr√°n derecho
                                        a presentar reclamaci√≥n ante la Agencia Espa√±ola de Protecci√≥n de Datos.
                                    </div>

                                    <div class="text-sm text-gray-700"
                                        style="text-align: justify; padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb;">
                                        <strong>3. Estoy informado/a de las condiciones que aplican al porcentaje m√°ximo
                                            de gastos generales:</strong><br><br>
                                        El importe de gastos generales que se considerar√° elegible a efectos de
                                        solicitar la cofinanciaci√≥n europea de la ayuda, ser√° el resultante de la
                                        aplicaci√≥n de un porcentaje del 15% sobre los gastos directos de personal del
                                        proyecto v√°lidamente justificados, en virtud de lo previsto en el Reglamento
                                        (UE) 651/2014, de 17 de junio.
                                    </div>

                                    <div class="text-sm text-gray-700" style="text-align: justify;">
                                        <strong>4. Estoy informado/a de las condiciones de
                                            cofinanciaci√≥n:</strong><br><br>
                                        En los proyectos cofinanciados con fondos FEDER, solo se financiar√°n aquellas
                                        actividades del proyecto que sean desarrolladas en el √°mbito geogr√°fico de la
                                        Comunidad Aut√≥noma que figure como "Comunidad de Desarrollo". En este sentido,
                                        la partida de ¬´Gastos de Personal¬ª corresponder√° a personas que realicen sus
                                        trabajos en dicha comunidad, de forma tal que el trabajador debe estar dado de
                                        alta en un centro de trabajo de la Comunidad Aut√≥noma correspondiente.
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4 class="font-semibold text-gray-800">Condiciones Presentaci√≥n Proyecto</h4>
                                <div class="space-y-4">
                                    <div class="text-sm text-gray-700"
                                        style="text-align: justify; padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb;">
                                        <strong>1. Confidencialidad y transparencia:</strong><br><br>
                                        En el supuesto de la existencia de informaci√≥n confidencial por raz√≥n de su
                                        vinculaci√≥n a secretos t√©cnicos o comerciales u otros motivos debidamente
                                        justificados, el solicitante deber√° designarla expresamente como tal en los
                                        documentos correspondientes, sin que sea admisible una declaraci√≥n gen√©rica de
                                        confidencialidad.<br><br>
                                        No obstante, de conformidad con la normativa vigente en materia de publicidad y
                                        transparencia de ayudas p√∫blicas, los datos del proyecto y de los beneficiarios
                                        as√≠ como el importe de la ayuda concedida, en su caso, ser√°n p√∫blicos. Esta
                                        informaci√≥n tambi√©n podr√° utilizarse con fines estad√≠sticos y de an√°lisis,
                                        seguimiento y mejora de las ayudas de I+D+i, y/o por exigencias legales.
                                    </div>

                                    <div class="text-sm text-gray-700"
                                        style="text-align: justify; padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb;">
                                        <strong>2. Estoy informado de que para dar cumplimiento al Reglamento (UE)
                                            2021/1060 del Parlamento Europeo y del Consejo de 24 de junio de
                                            2021,</strong> se requiere un informe favorable, √∫nico por proyecto y
                                        emitido por entidad acreditada por la ENAC seg√∫n el esquema RDE-31, que confirme
                                        el cumplimiento del principio de ¬´no causar un perjuicio significativo¬ª √≥ DNSH
                                        por sus siglas en ingl√©s. El informe se presentar√° por la empresa al CDTI entre
                                        la aprobaci√≥n del proyecto y la firma del contrato. El informe deber√° responder
                                        a los objetivos del art. 9 y a los aspectos recogidos en el art. 17 del
                                        Reglamento (UE) 2020/852 del Parlamento Europeo y del Consejo de 18 de junio de
                                        2020 y sus actos delegados.
                                    </div>

                                    <div class="text-sm text-gray-700"
                                        style="text-align: justify; padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb;">
                                        <strong>3. Materias excluidas:</strong><br><br>
                                        Estoy informado de las materias excluidas de la cofinanciaci√≥n FEDER recogidas
                                        en el Art√≠culo 7 del REGLAMENTO (UE) 2021/1058 DEL PARLAMENTO EUROPEO Y DEL
                                        CONSEJO de 24 de junio de 2021.
                                    </div>

                                    <div class="text-sm text-gray-700"
                                        style="text-align: justify; padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb;">
                                        <strong>4. Declaro que:</strong><br><br>
                                        A) Toda la informaci√≥n que figura en esta solicitud es veraz.<br><br>
                                        B) Me comprometo a informar de todas las modificaciones sustanciales previas a
                                        la aprobaci√≥n del proyecto. Si cualquiera de las anteriores condiciones se viese
                                        incumplida, se podr√≠a suspender la evaluaci√≥n del proyecto.
                                    </div>

                                    <div class="text-sm text-gray-700" style="text-align: justify;">
                                        <strong>5. Estoy informado/a de las condiciones de la CCAA:</strong><br><br>
                                        En el proceso de evaluaci√≥n de la propuesta, el CDTI podr√° pedir un informe de
                                        valoraci√≥n al organismo competente de la Comunidad Aut√≥noma en donde se vaya a
                                        realizar el proyecto. Acepto que se env√≠e la documentaci√≥n de la propuesta a
                                        dicho organismo para la realizaci√≥n de dicho informe de valoraci√≥n.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="form-message" class="hidden h-4"></div>

                        <div id="form-navigation">
                            <button type="button" id="prev-btn" onclick="navigatePage(-1)">
                                Atr√°s
                            </button>
                            <span id="page-indicator" class="hidden"></span>
                            <button type="button" id="next-btn" onclick="navigatePage(1)">
                                Siguiente
                            </button>
                            <button type="submit" id="save-btn" class="hidden">
                                Guardar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div id="admin-view" class="hidden space-y-6">
            <div class="page-header">
                <h2 style="margin:0; font-size: 1.75rem; font-weight: 400;">Panel de Administraci√≥n</h2>
                <button onclick="logout()" class="btn-primary" style="background-color: var(--md-sys-color-error);">
                    <span class="material-symbols-outlined">logout</span>
                    Cerrar Sesi√≥n
                </button>
            </div>

            <!-- Gesti√≥n de Usuarios -->
            <div class="form-section">
                <h3
                    style="color: var(--md-sys-color-primary); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span class="material-symbols-outlined">group</span>
                    Gesti√≥n de Usuarios
                </h3>

                <!-- Formulario para crear nuevo usuario -->
                <div
                    style="background-color: var(--md-sys-color-secondary-container); padding: 1.5rem; border-radius: var(--md-sys-shape-corner-medium); margin-bottom: 2rem;">
                    <h4
                        style="margin-top: 0; margin-bottom: 1rem; color: var(--md-sys-color-on-secondary-container); font-weight: 600;">
                        Crear Nuevo Usuario</h4>
                    <div class="form-grid md:grid-cols-3" style="align-items: end;">
                        <div>
                            <label for="new-user-id">ID Cliente / Nombre</label>
                            <input type="text" id="new-user-id" class="input-default" placeholder="ej: empresa-abc">
                        </div>
                        <div>
                            <label for="new-user-password">Contrase√±a</label>
                            <input type="text" id="new-user-password" class="input-default"
                                placeholder="Contrase√±a para el cliente">
                        </div>
                        <button onclick="createNewUser()" class="btn-primary"
                            style="width: 100%; background-color: var(--success);">
                            <span class="material-symbols-outlined">person_add</span>
                            Crear Usuario
                        </button>
                    </div>
                    <p
                        style="font-size: 0.75rem; color: var(--md-sys-color-on-secondary-container); margin-top: 0.75rem; opacity: 0.8;">
                        <span class="material-symbols-outlined"
                            style="font-size: 1rem; vertical-align: text-bottom;">info</span>
                        El ID ser√° √∫nico para cada cliente. La contrase√±a se enviar√° al cliente para que pueda acceder.
                    </p>
                </div>

                <!-- Lista de usuarios existentes -->
                <div>
                    <h4 style="margin-bottom: 1rem; font-weight: 500;">Usuarios Existentes</h4>
                    <div class="table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID Cliente</th>
                                    <th>Contrase√±a</th>
                                    <th>Estado</th>
                                    <th>Creado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <tr>
                                    <td colspan="5"
                                        style="text-align: center; padding: 2rem; color: var(--md-sys-color-on-surface-variant);">
                                        Cargando usuarios...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Datos Recopilados -->
            <div class="form-section">
                <h3
                    style="color: var(--md-sys-color-primary); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span class="material-symbols-outlined">monitoring</span>
                    Datos Recopilados (Tiempo Real)
                </h3>

                <div class="flex justify-between items-center mb-4" style="flex-wrap: wrap; gap: 1rem;">
                    <p style="font-size: 0.875rem; color: var(--md-sys-color-on-surface-variant); margin: 0;">
                        <span style="font-weight: 500;">ID de la Aplicaci√≥n:</span>
                        <span id="app-id-display"
                            style="background-color: var(--md-sys-color-surface-variant); padding: 4px 8px; border-radius: 4px; font-family: monospace; margin-left: 0.5rem;"></span>
                    </p>
                    <button onclick="exportToCSV()" class="btn-primary" style="background-color: var(--success);">
                        <span class="material-symbols-outlined">download</span>
                        Exportar a Excel
                    </button>
                </div>

                <div class="table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>√ölt. Guardado</th>
                                <th>ID Cliente</th>
                                <th>Nombre (Inst.)</th>
                                <th>Email (Inst.)</th>
                                <th>Tel√©fono (Inst.)</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="data-table-body">
                            <tr>
                                <td colspan="6"
                                    style="text-align: center; padding: 2rem; color: var(--md-sys-color-on-surface-variant);">
                                    Cargando datos...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p id="data-loading-status"
                    style="text-align: center; font-size: 0.875rem; color: var(--md-sys-color-on-surface-variant); margin-top: 1rem;">
                </p>
            </div>
        </div>
    </div>

    <div id="message-modal" class="fixed inset-0 modal-overlay hidden items-center justify-center p-4 z-50">
        <div class="modal-box">
            <h3 id="modal-title" class="modal-title"></h3>
            <p id="modal-content" class="modal-content"></p>
            <input type="password" id="modal-input" class="hidden modal-input mb-4"
                placeholder="Clave de Administrador">
            <div class="modal-actions">
                <button id="modal-cancel-btn" class="hidden" style="background-color: #6b7280;">Cancelar</button>
                <button id="modal-confirm-btn" class="">Aceptar</button>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <span>¬© DEINCOTEC ¬∑ Consultor√≠a I+D+i</span>
    </footer>

    <!-- Pop-up de Informaci√≥n -->
    <div id="info-popup-overlay" class="info-popup-overlay">
        <div class="info-popup">
            <div class="info-popup-header">
                <h4>
                    <span class="material-symbols-outlined info-icon">info</span>
                    <span id="info-popup-title">Informaci√≥n</span>
                </h4>
                <button class="info-popup-close" onclick="closeInfoPopup()">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div id="info-popup-content" class="info-popup-content">
                <!-- El contenido se insertar√° din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Scripts - Cargar en orden de dependencias -->
    <!-- 1. M√≥dulos de infraestructura (sin dependencias) -->
    <script type="module" src="error-handler.js"></script>
    <script type="module" src="state-manager.js"></script>
    <script type="module" src="nif-validator.js"></script>

    <!-- 2. Validaci√≥n (depende de nif-validator) -->
    <script type="module" src="validation.js"></script>

    <!-- 3. Servicios (dependen de state y error) -->
    <script type="module" src="auth.js"></script>
    <script type="module" src="firestore-service.js"></script>
    <script type="module" src="ui-manager.js"></script>

    <!-- 4. Main app (orquesta todos los m√≥dulos) -->
    <script type="module" src="main.js"></script>
    
    <!-- Debug script -->
    <script>
        // Verificar que las funciones globales est√©n disponibles despu√©s de cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('üîç Verificando funciones globales...');
                console.log('promptAdminKey disponible:', typeof window.promptAdminKey);
                console.log('handleGoogleLogin disponible:', typeof window.handleGoogleLogin);
                console.log('handleAdminLogin disponible:', typeof window.handleAdminLogin);
            }, 2000);
        });
        
        // ========================================
        // Funcionalidad: Seleccionar todos - OTRAS DECLARACIONES
        // ========================================
        function setupSelectAllOtrasDeclaraciones() {
            const selectAllCheckbox = document.getElementById('decl_select_all_otras');
            
            if (!selectAllCheckbox) {
                console.log('‚è≥ Checkbox "Seleccionar todos" no encontrado a√∫n...');
                return false;
            }

            // Lista de IDs de los checkboxes de "Otras Declaraciones"
            const checkboxIds = [
                'decl_cumple_requisitos',
                'decl_no_inicio_previo',
                'decl_cumple_normativa',
                'decl_sujeto_control',
                'decl_representante_agrupacion',
                'decl_respeta_dnsh',
                'decl_no_deudas',
                'decl_autoriza_cesion_datos'
            ];
            
            const checkboxes = checkboxIds.map(id => document.getElementById(id)).filter(el => el !== null);
            
            if (checkboxes.length === 0) {
                console.log('‚ö†Ô∏è No se encontraron los checkboxes individuales');
                return false;
            }

            console.log(`‚úÖ Configurando "Seleccionar todos" con ${checkboxes.length} checkboxes`);

            // Evento click en "Seleccionar todos"
            selectAllCheckbox.onclick = function() {
                const isChecked = this.checked;
                console.log('üñ±Ô∏è Click en Seleccionar todos:', isChecked);
                
                checkboxes.forEach(cb => {
                    cb.checked = isChecked;
                });
                
                // Trigger autosave si existe
                if (window.debouncedSave) {
                    window.debouncedSave();
                }
            };
            
            // Sincronizar cuando cambian los individuales
            checkboxes.forEach(cb => {
                cb.addEventListener('change', function() {
                    const allChecked = checkboxes.every(c => c.checked);
                    const someChecked = checkboxes.some(c => c.checked);
                    selectAllCheckbox.checked = allChecked;
                    selectAllCheckbox.indeterminate = someChecked && !allChecked;
                });
            });
            
            console.log('‚úì "Seleccionar todos" OTRAS DECLARACIONES configurado correctamente');
            return true;
        }
        
        // ========================================
        // Funcionalidad: Seleccionar todos - CUMPLIMIENTO FEDER
        // ========================================
        function setupSelectAllFeder() {
            const selectAllCheckbox = document.getElementById('decl_select_all_feder');
            
            if (!selectAllCheckbox) {
                return false;
            }

            const checkboxIds = [
                'decl_feder_personal_ca',
                'decl_feder_conoce_condiciones',
                'decl_feder_capacidad',
                'decl_feder_cumple_reglamento',
                'decl_feder_publicidad',
                'decl_feder_licencia_ue',
                'decl_feder_conoce_minoracion',
                'decl_feder_operacion_no_concluida',
                'decl_feder_conservar_docs',
                'decl_feder_registros_contables',
                'decl_feder_conoce_antifraude',
                'decl_feder_informado_medidas',
                'decl_feder_difundir_comunicado',
                'decl_feder_durabilidad',
                'decl_feder_indicadores',
                'decl_feder_comprobacion',
                'decl_feder_cooperacion',
                'decl_feder_analisis_riesgos',
                'decl_feder_lista_operaciones',
                'decl_feder_accesibilidad',
                'decl_feder_autoriza_facilitar'
            ];
            
            const checkboxes = checkboxIds.map(id => document.getElementById(id)).filter(el => el !== null);
            
            if (checkboxes.length === 0) {
                return false;
            }

            console.log(`‚úÖ Configurando "Seleccionar todos" FEDER con ${checkboxes.length} checkboxes`);

            selectAllCheckbox.onclick = function() {
                const isChecked = this.checked;
                checkboxes.forEach(cb => { cb.checked = isChecked; });
                if (window.debouncedSave) { window.debouncedSave(); }
            };
            
            checkboxes.forEach(cb => {
                cb.addEventListener('change', function() {
                    const allChecked = checkboxes.every(c => c.checked);
                    const someChecked = checkboxes.some(c => c.checked);
                    selectAllCheckbox.checked = allChecked;
                    selectAllCheckbox.indeterminate = someChecked && !allChecked;
                });
            });
            
            console.log('‚úì "Seleccionar todos" CUMPLIMIENTO FEDER configurado correctamente');
            return true;
        }
        
        // ========================================
        // Funcionalidad: Seleccionar todos - LISTA COMPROBACI√ìN PROYECTO
        // ========================================
        function setupSelectAllProyecto() {
            const selectAllCheckbox = document.getElementById('decl_select_all_proyecto');
            
            if (!selectAllCheckbox) {
                return false;
            }

            const checkboxIds = [
                'decl_proy_autorizaciones',
                'decl_proy_normas_ambientales',
                'decl_proy_desarrollo_sostenible',
                'decl_proy_dimension_genero',
                'decl_proy_impacto_genero',
                'decl_proy_eliminar_desigualdades',
                'decl_proy_lucha_discriminacion',
                'decl_proy_ayuda_reembolsable'
            ];
            
            const checkboxes = checkboxIds.map(id => document.getElementById(id)).filter(el => el !== null);
            
            if (checkboxes.length === 0) {
                return false;
            }

            console.log(`‚úÖ Configurando "Seleccionar todos" PROYECTO con ${checkboxes.length} checkboxes`);

            selectAllCheckbox.onclick = function() {
                const isChecked = this.checked;
                checkboxes.forEach(cb => { cb.checked = isChecked; });
                if (window.debouncedSave) { window.debouncedSave(); }
            };
            
            checkboxes.forEach(cb => {
                cb.addEventListener('change', function() {
                    const allChecked = checkboxes.every(c => c.checked);
                    const someChecked = checkboxes.some(c => c.checked);
                    selectAllCheckbox.checked = allChecked;
                    selectAllCheckbox.indeterminate = someChecked && !allChecked;
                });
            });
            
            console.log('‚úì "Seleccionar todos" LISTA COMPROBACI√ìN PROYECTO configurado correctamente');
            return true;
        }
        
        // Intentar configurar peri√≥dicamente hasta que funcione
        let attempts = 0;
        const maxAttempts = 20;
        const intervalId = setInterval(() => {
            attempts++;
            const otrasOk = setupSelectAllOtrasDeclaraciones();
            const federOk = setupSelectAllFeder();
            const proyectoOk = setupSelectAllProyecto();
            
            if ((otrasOk && federOk && proyectoOk) || attempts >= maxAttempts) {
                clearInterval(intervalId);
                if (attempts >= maxAttempts) {
                    console.log('‚ö†Ô∏è Algunos "Seleccionar todos" no se configuraron despu√©s de', maxAttempts, 'intentos');
                }
            }
        }, 500);
    </script>
</body>

</html>